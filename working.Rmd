---
output:
  html_document
---

```{r load-packages, include=FALSE, cache=FALSE}
##  Clear environment and list required packages:
    required_packages <- c("tidyverse", "dplyr", "captioner", "tinytex", "kableExtra", "formattable", 
                           "readr", "irr", "psycho", "afex", "emmeans", "janitor")
    #library(ggpubr)
    #library(psych)
    #library(rstatix)
    packages_to_install <- required_packages[!(required_packages %in% installed.packages()[,"Package"])]
    if(length(packages_to_install)) install.packages(packages_to_install)
    invisible(suppressPackageStartupMessages(lapply(required_packages, library, character.only = TRUE)))
```

```{r, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#################################################################################################################
##    Experiment 5 - Prop hits:                                                                                ##
################################################################################################################# 
#----------------------------------------------------------------------------------------------------------------
#   Prep data for analysis:
#----------------------------------------------------------------------------------------------------------------
    exp5__anova__PROP.HITS_data <- exp5__final_data %>%
        select(id, prop_grey_word_hit, prop_distinctive_word_hit, prop_grey_drawing_hit, 
               prop_col_drawing_hit, prop_grey_photo_hit, prop_col_photo_hit) %>%
        rename("Grey words" = "prop_grey_word_hit", "Distinctive words" = "prop_distinctive_word_hit",
               "Grey drawings" = "prop_grey_drawing_hit", "Colour drawings" = "prop_col_drawing_hit",
               "Grey photos" = "prop_grey_photo_hit", "Colour photos" = "prop_col_photo_hit") %>%
        gather(key = "stim_format", value = "hit", "Grey words", "Distinctive words", "Grey drawings", 
               "Colour drawings", "Grey photos", "Colour photos") %>%
        mutate(distinctiveness = ifelse(str_detect(stim_format, "^Grey"), "Low", 
                                        ifelse(str_detect(stim_format, "^Distinctive"), "High", 
                                               ifelse(str_detect(stim_format, "^Colour"), "High", "")))) %>%
        mutate(stim_format = str_replace(stim_format, "Grey words", "Words")) %>%
        mutate(stim_format = str_replace(stim_format, "Distinctive words", "Words")) %>%
        mutate(stim_format = str_replace(stim_format, "Grey drawings", "Drawings")) %>%
        mutate(stim_format = str_replace(stim_format, "Colour drawings", "Drawings")) %>%
        mutate(stim_format = str_replace(stim_format, "Grey photos", "Photos")) %>%
        mutate(stim_format = str_replace(stim_format, "Colour photos", "Photos")) %>%
        arrange(id) %>%
        transform(stim_format = factor(stim_format, levels=c("Words", "Drawings", "Photos"))) %>%
        transform(distinctiveness = factor(distinctiveness, levels=c("Low", "High"))) %>%
        transform(id = factor(id))
#----------------------------------------------------------------------------------------------------------------
#   Summary stats:
#----------------------------------------------------------------------------------------------------------------
    exp5__anova__PROP.HITS_data_summary <- exp5__anova__PROP.HITS_data %>%
        group_by(stim_format, distinctiveness) %>%
        get_summary_stats(hit, type = "mean_sd")



#----------------------------------------------------------------------------------------------------------------
#   Run two-way repeated measures ANOVA:
#----------------------------------------------------------------------------------------------------------------
exp5__anova__PROP.HITS <- aov_car(hit ~ stim_format*distinctiveness 
                                  + Error(id / stim_format*distinctiveness), 
                                  data = exp5__anova__PROP.HITS_data)
# We need to specify an error term that accounts for natural variation from participant to participant. We do 
# this with the Error() function: specifically, we are saying that we want to control for that 
# between-participant variation over all of our within-subjects variables.
```

`r exp5__anova__PROP.HITS`


```{r, echo=FALSE, cache=FALSE}
    exp5__anova__PROP.HITS_data_summary %>%
      kable("latex", booktabs = T) %>%
      kable_styling(latex_options = c("hold_position", "scale_down")) %>%
      column_spec(1, width = "4cm")
```






```{r, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#----------------------------------------------------------------------------------------------------------------
#   Identify outliers:
#----------------------------------------------------------------------------------------------------------------
    outliers <- exp5__anova__PROP.HITS_data %>%
      group_by(stim_format, distinctiveness) %>%
      identify_outliers(hit)




```
